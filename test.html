<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ChefMate - Recipe Finder</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=favorite" />
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- Burger icon always visible -->
  <span class="burger" onclick="toggleSidebar()">‚ò∞</span>

  <!-- Sidebar (links hidden until open) -->
  <div id="sidebar" class="sidebar">
  <a href="javascript:void(0)" class="closebtn" onclick="toggleSidebar()">√ó</a>
  <a href="#" onclick="goHome()">üè† Home</a>
  <a href="#" onclick="showSection('favoritesSection')">‚≠ê Favorites</a>
  <a href="#" onclick="showSection('historySection')">üïò History</a>
  <a href="javascript:void(0)" onclick="toggleDarkMode()">üåô Dark Mode</a>
  <!--a href="#" onclick="showSection('contactSection')">üì© Contact</a-->
  <a href="#" onclick="showSection('aboutSection')">üìñ About</a>
  <a id="authLink" href="login.html" style="position: absolute; bottom: 10px;">üîê Logout</a>
  </div>

  <header>
    <h1>üçΩÔ∏è ChefMate</h1>
    <span>Enter ingredients and get smart recipe suggestions</span>
    <div id="userBadge" style="position:absolute; right:18px; top:18px; font-weight:700; color:#2c3e50;"></div>
  </header>

  <main>
    <center id="homeSection">
      <label for="ingredientsInput">Enter Ingredients (e.g., chicken, onion, tomato):</label>
      <div class="search-wrapper">
        <input type="text" id="ingredientsInput" placeholder="e.g., eggs, milk, butter" />
        <button id="clearInput" onclick="clearSearch()">√ó</button>
      </div>
  <button id="getRecipesBtn" onclick="getRecipes()">Get Recipes</button>
      <div id="recipes"></div>
    </center>

    <!-- Favorites Section -->
    <section id="favoritesSection">
      <h2>‚≠ê Favorites</h2>
      <div id="favorites"></div>
    </section>

    <!-- History Section -->
    <section id="historySection">
      <h2>üïò History</h2>
      <div id="history"></div>
    </section>

    <!-- Contact Section -->
    <section id="contactSection">
      <h2>üìß Contact</h2>
      <form id="contactForm">
        <label for="contactName">Name:</label>
        <input type="text" id="contactName" name="contactName" required><br>
        <label for="contactEmail">Email:</label>
        <input type="email" id="contactEmail" name="contactEmail" required><br>
        <label for="contactMessage">Message:</label>
        <textarea id="contactMessage" name="contactMessage" required></textarea><br>
        <button type="submit">Send</button>
      </form>
      <div id="contactResult"></div>
    </section>

    <!-- About Section -->
    <section id="aboutSection">
      <h2>üìñ About</h2>
      <div class="about-content">
        <p>
          <strong>Welcome to SmartChef!</strong> <br><br>
          SmartChef is more than just a recipe finder‚Äîit's your personal kitchen companion, designed to inspire creativity and make cooking effortless for everyone, everywhere. Whether you're a beginner, a busy professional, or a seasoned chef, SmartChef helps you turn everyday ingredients into extraordinary meals.<br><br>
          <strong>How does it work?</strong><br>
          Simply enter the ingredients you have at home, and SmartChef instantly suggests delicious recipes tailored to your pantry. No more wasted food or last-minute grocery runs‚Äîjust smart, practical, and tasty solutions at your fingertips.<br><br>
          <strong>Features you'll love:</strong>
          <ul>
            <li><b>Favorites:</b> Save the recipes you love and access them anytime.</li>
            <li><b>History:</b> Track all your previous searches and rediscover your kitchen adventures.</li>
            <li><b>Contact:</b> Reach out for support, feedback, or collaboration‚ÄîSmartChef is here for you.</li>
            <li><b>International Design:</b> Enjoy a modern, elegant interface built for users around the world.</li>
          </ul>
          <strong>Why SmartChef?</strong><br>
          We believe that cooking should be fun, accessible, and inspiring. SmartChef empowers you to explore new cuisines, reduce food waste, and make every meal memorable. Our platform is constantly evolving, bringing you the latest in smart cooking technology and global culinary trends.<br><br>
          <strong>Be amazed. Be inspired. Be a SmartChef.</strong><br>
          Start your culinary journey today and discover the magic in your kitchen!
        </p>
      </div>
    </section>
  </main>

  <script>
    // Show/hide sections based on sidebar navigation
    function showSection(sectionId) {
      const sections = [
        'homeSection',
        'favoritesSection',
        'historySection',
        'contactSection',
        'aboutSection'
      ];
      for (const id of sections) {
        const el = document.getElementById(id);
        if (el) el.style.display = (id === sectionId) ? '' : 'none';
      }
      toggleSidebar();
      localStorage.setItem('chefmate_last_section', sectionId);
    }

    // Home button logic: show Home section and reset input/search
    function goHome() {
      showSection('homeSection');
      // Reset input and search results
      var input = document.getElementById('ingredientsInput');
      var clearBtn = document.getElementById('clearInput');
      if (input) input.value = '';
      if (clearBtn) clearBtn.style.display = 'none';
      var recipesDiv = document.getElementById('recipes');
      if (recipesDiv) recipesDiv.innerHTML = '';
      localStorage.setItem('chefmate_last_section', 'homeSection');
    }
    // Show home or last section by default
    window.onload = function() {
      // Always show Home section on reload
      showSection('homeSection');
      localStorage.setItem('chefmate_last_section', 'homeSection');
      
    };

    const API_KEY = "76c6ff2c5e6245b8a2f70d168da1bc46"; // Your Spoonacular API key
    // LocalStorage keys
    const FAVORITES_KEY = "chefmate_favorites";
    const HISTORY_KEY = "chefmate_history";

    let currentOffset = 0; // track pagination offset
    let lastSearch = "";   // store last searched ingredient

    async function getRecipes(loadMore = false) {
        const input = document.getElementById("ingredientsInput").value.trim();
        const recipesDiv = document.getElementById("recipes");

        if (!loadMore) {
            currentOffset = 0;
            lastSearch = input;
            recipesDiv.innerHTML = "<br>Loading recipes...";
            if (input) saveToHistory(input);
        }

        if (!input) {
            recipesDiv.innerHTML = "<br>Please enter at least one ingredient.";
            return;
        }

        try {
            const response = await fetch(
            `https://api.spoonacular.com/recipes/findByIngredients?ingredients=${encodeURIComponent(
                input
            )}&number=10&offset=${currentOffset}&apiKey=${API_KEY}`
            );

            const data = await response.json();

            if (!data || !Array.isArray(data) || data.length === 0) {
            if (!loadMore) {
                recipesDiv.innerHTML = `<br>No recipes found with "${input}".`;
            } else {
                recipesDiv.innerHTML += `<br>No more recipes to load.`;
            }
            return;
            }

            if (!loadMore) recipesDiv.innerHTML = "";

            renderRecipes(data);

            const oldBtn = document.getElementById("loadMoreBtn");
            if (oldBtn) oldBtn.remove();

            const loadMoreBtn = document.createElement("button");
            loadMoreBtn.id = "loadMoreBtn";
            loadMoreBtn.textContent = "Load More Recipes";
            loadMoreBtn.onclick = () => {
            currentOffset += 10;
            getRecipes(true);
            };

            recipesDiv.appendChild(loadMoreBtn);
        } catch (error) {
            recipesDiv.innerHTML = "‚ö†Ô∏è Error loading recipes.";
            console.error(error);
        }
    }

    function renderRecipes(recipes) {
        const recipesDiv = document.getElementById("recipes");

        for (let recipe of recipes) {
            const used = (recipe.usedIngredients || []).map(i => i.original).join(", ");
            const missed = (recipe.missedIngredients || []).map(i => i.original).join(", ");

            const recipeDiv = document.createElement("div");
            recipeDiv.className = "recipe";

            const favorites = getFavorites();
            const isFavorited = favorites.some(r => r.id === recipe.id);

            recipeDiv.innerHTML = `
            <span class="favorite-icon material-symbols-outlined ${isFavorited ? 'favorited' : ''}" data-recipe-id="${recipe.id}" onclick="toggleFavoriteRecipe(${recipe.id}, this)">favorite</span>
            <h3>${recipe.title}</h3>
            <img src="${recipe.image}" alt="${recipe.title}"/>
            <p><b>Used Ingredients:</b> ${used || "None"}</p>
            <p><b>Missing Ingredients:</b> ${missed || "None!"}</p><br>
        <button class="primary-btn" onclick="getInstructions(${recipe.id}, this)">Show Instructions</button>
            <div class="instructions"></div>
            `;

            recipesDiv.appendChild(recipeDiv);
        }
    }

    // FAVORITES LOGIC
    function getFavorites() {
        try {
            return JSON.parse(localStorage.getItem(FAVORITES_KEY)) || [];
        } catch {
            return [];
        }
    }

    function saveFavorites(favorites) {
    localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
    renderFavorites();
    // Sync heart icons across the UI after favorites change
    syncHeartIcons();
    }

    function toggleFavoriteRecipe(id, el) {
    let favorites = getFavorites();
    const recipesDiv = document.getElementById("recipes");
    const recipeEls = recipesDiv ? recipesDiv.getElementsByClassName("recipe") : [];
    let recipeData = null;
    for (let recipeEl of recipeEls) {
        if (recipeEl.querySelector(".favorite-icon") === el) {
        recipeData = {
            id,
            title: recipeEl.querySelector("h3").textContent,
            image: recipeEl.querySelector("img").src
        };
        break;
        }
    }
    if (!recipeData) return;
    if (el.classList.contains("favorited")) {
        favorites = favorites.filter(r => r.id !== id);
        el.classList.remove("favorited");
    } else {
        favorites.push(recipeData);
        el.classList.add("favorited");
    }
    saveFavorites(favorites);
    }

    function renderFavorites() {
    const favoritesDiv = document.getElementById("favorites");
    if (!favoritesDiv) return;
    const favorites = getFavorites();
    if (!favorites.length) {
        favoritesDiv.innerHTML = "<p>No favorites yet.</p>";
        return;
    }

    // Render grid container
    favoritesDiv.innerHTML = "";
    const grid = document.createElement('div');
    grid.className = 'favorites-grid';

    for (let fav of favorites) {
        const card = document.createElement('div');
        card.className = 'fav-card';

        // description fallback: use stored summary or title
        const desc = fav.summary || fav.description || fav.title || '';

        card.innerHTML = `
        <img class="card-media" src="${fav.image}" alt="${fav.title}" onclick="openRecipeFromFavorite(${fav.id})" />
        <div class="card-body">
            <div class="card-title">${fav.title}</div>
            <div class="card-desc">${desc}</div>
        </div>
        <div class="card-footer">
            <span style="color: #6b7280; font-weight:600; font-size:0.95em;">Recipe</span>
            <button class="fav-remove" onclick="removeFavorite(${fav.id})">Remove</button>
        </div>
        `;

        grid.appendChild(card);
    }

    favoritesDiv.appendChild(grid);
    }

    // Open a favorite recipe in main recipes area
    async function openRecipeFromFavorite(recipeId) {
    const recipesDiv = document.getElementById('recipes');
    if (!recipesDiv) return;
    recipesDiv.innerHTML = '<br>Loading recipe...';
    try {
        const response = await fetch(`https://api.spoonacular.com/recipes/${recipeId}/information?apiKey=${API_KEY}`);
        const data = await response.json();
        // Render a focused single recipe card
        renderSingleRecipe(data);
    } catch (err) {
        console.error(err);
        recipesDiv.innerHTML = '<br>Failed to load recipe.';
    }
    }

    function renderSingleRecipe(recipe) {
    const recipesDiv = document.getElementById('recipes');
    if (!recipesDiv) return;
    const used = '';
    const missed = '';
    recipesDiv.innerHTML = '';
    const recipeDiv = document.createElement('div');
    recipeDiv.className = 'recipe';
    const favorites = getFavorites();
    const isFavorited = favorites.some(r => r.id === recipe.id);
    recipeDiv.innerHTML = `
        <span class="favorite-icon material-symbols-outlined ${isFavorited ? 'favorited' : ''}" data-recipe-id="${recipe.id}" onclick="toggleFavoriteRecipe(${recipe.id}, this)">favorite</span>
        <h3>${recipe.title}</h3>
        <img src="${recipe.image}" alt="${recipe.title}" />
        <p><b>Ready in:</b> ${recipe.readyInMinutes || 'N/A'} minutes</p>
        <p><b>Servings:</b> ${recipe.servings || 'N/A'}</p>
        <div class="instructions">${recipe.summary || ''}</div>
    `;
    recipesDiv.appendChild(recipeDiv);
    }

    // Keep favorite heart icons visually in sync across Home and Favorites
    function syncHeartIcons() {
    try {
        const favs = getFavorites();
        const favIds = new Set(favs.map(f => String(f.id)));
        const icons = document.querySelectorAll('.favorite-icon');
        icons.forEach(icon => {
        const rid = icon.dataset && icon.dataset.recipeId ? String(icon.dataset.recipeId) : null;
        if (rid && favIds.has(rid)) {
            icon.classList.add('favorited');
        } else {
            icon.classList.remove('favorited');
        }
        });
    } catch (e) {
        console.error('syncHeartIcons error', e);
    }
    }

    function removeFavorite(id) {
    let favorites = getFavorites();
    favorites = favorites.filter(r => r.id !== id);
    saveFavorites(favorites);
    }

    // HISTORY LOGIC
    function getHistory() {
    try {
        return JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
    } catch {
        return [];
    }
    }

    function saveToHistory(search) {
    if (!search) return;
    let history = getHistory();
    history = history.filter(item => item !== search);
    history.unshift(search);
    if (history.length > 10) history = history.slice(0, 10);
    localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
    renderHistory();
    }

    function renderHistory() {
    const historyDiv = document.getElementById("history");
    if (!historyDiv) return;
    const history = getHistory();
    historyDiv.innerHTML = history.length ? "" : "<p>No history yet.</p>";
    for (let item of history) {
        const itemDiv = document.createElement("div");
        itemDiv.className = "history-item";
        itemDiv.innerHTML = `
        <span>üîé ${item}</span>
        <button onclick="searchFromHistory('${item}')">Search Again</button>
        `;
        historyDiv.appendChild(itemDiv);
    }
    }

    function searchFromHistory(item) {
    if (typeof showSection === 'function') {
        showSection('homeSection');
    }
    const inputEl = document.getElementById("ingredientsInput");
    if (inputEl) inputEl.value = item;
    getRecipes();
    }

    async function getInstructions(recipeId, button) {
    const instructionDiv = button.nextElementSibling;
    instructionDiv.innerHTML = "Loading...";

    try {
        const response = await fetch(
        `https://api.spoonacular.com/recipes/${recipeId}/analyzedInstructions?apiKey=${API_KEY}`
        );
        const data = await response.json();

        if (data.length && data[0].steps && data[0].steps.length) {
        const steps = data[0].steps
            .map((step, index) => {
            return `
                <div style="margin: 15px 0; text-align: justify;">
                <b style="display:block; text-align:left;">Step ${index + 1}:</b>
                <p style="margin: 5px 0; text-indent: 0px; text-align: justify;">
                    ${step.step}
                </p>
                </div>
            `;
            })
            .join("");

        instructionDiv.innerHTML = `
            <div class="instruction-text">
            <h4>Instructions:</h4>
            ${steps}
            </div>
        `;
        } else {
        const summaryResponse = await fetch(
            `https://api.spoonacular.com/recipes/${recipeId}/summary?apiKey=${API_KEY}`
        );
        const summaryData = await summaryResponse.json();
        instructionDiv.innerHTML = `<p>${summaryData.summary || "No instructions found."}</p>`;
        }
    } catch (error) {
        instructionDiv.innerHTML = "<br>Failed to load instructions.";
        console.error(error);
    }
    }

    function toggleSidebar() {
    const sidebar = document.getElementById("sidebar");
    if (!sidebar) return;
    if (sidebar.style.width === "190px") {
        sidebar.style.width = "0";  // Close
    } else {
        sidebar.style.width = "190px";  // Open
    }
    }

    // CONTACT LOGIC
    const contactForm = document.getElementById("contactForm");
    if (contactForm) {
    contactForm.addEventListener("submit", function(e) {
        e.preventDefault();
        const name = document.getElementById("contactName").value.trim();
        const email = document.getElementById("contactEmail").value.trim();
        const message = document.getElementById("contactMessage").value.trim();
        const resultDiv = document.getElementById("contactResult");
        if (!name || !email || !message) {
        resultDiv.textContent = "Please fill out all fields.";
        resultDiv.style.color = "red";
        return;
        }
        if (!email.match(/^[^@\\s]+@[^@\\s]+\.[^@\\s]+$/)) {
        resultDiv.textContent = "Invalid email address.";
        resultDiv.style.color = "red";
        return;
        }
        resultDiv.textContent = `Thank you, ${name}! Your message has been sent.`;
        resultDiv.style.color = "green";
        contactForm.reset();
    });
    }

    /* üåô Dark Mode toggle */
    const DARK_KEY = "chefmate_dark_mode";

    function initDarkMode() {
    const enabled = localStorage.getItem(DARK_KEY) === "enabled";
    if (enabled) {
        document.body.classList.add("dark-mode");
    }
    }

    function toggleDarkMode() {
    document.body.classList.toggle("dark-mode");
    if (document.body.classList.contains("dark-mode")) {
        localStorage.setItem(DARK_KEY, "enabled");
    } else {
        localStorage.setItem(DARK_KEY, "disabled");
    }
    }

    // auto init on page load
    initDarkMode();
    renderFavorites();
    renderHistory();
    // ensure heart icons reflect stored favorites
    syncHeartIcons();

    const input = document.getElementById("ingredientsInput");
    const clearBtn = document.getElementById("clearInput");
    if (input && clearBtn) {
    // Show clear button when user types
    input.addEventListener("input", () => {
        if (input.value.trim() !== "") {
        clearBtn.style.display = "block";
        } else {
        clearBtn.style.display = "none";
        }
    });
    }

    // Clear function
    function clearSearch() {
    if (!input || !clearBtn) return;
    input.value = "";
    clearBtn.style.display = "none";
    const recipesEl = document.getElementById("recipes");
    if (recipesEl) recipesEl.innerHTML = ""; // remove displayed recipes
    currentOffset = 0; // reset offset for new searches
    }
  </script>
</body>


</html>